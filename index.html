
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ê–ù-–û-–ú–ê–¢–ò–ö 3000 (SOVEREIGN NODE)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #0a0a0a; color: #e0e0e0; margin: 0; }
        .scanline { width: 100%; height: 100px; z-index: 99; background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255,0,0,0.05) 50%, rgba(0,0,0,0) 100%); opacity: 0.1; position: fixed; bottom: 100%; animation: scanline 8s linear infinite; pointer-events: none; }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100px; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scanline"></div>
    <script type="text/babel" data-presets="react,typescript">
      // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ API –∫–ª—é—á–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã Gemini –≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
      window.process = { env: { API_KEY: 'GEMINI_API_KEY' } };
      
      // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ Lucide —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –¥–ª—è –±–∞–Ω–¥–ª–∞)
      // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∏ –∏–ª–∏ SVG, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–∏–º —Ç–µ–∫—Å—Ç
      
/* MODULE: types */

interface Service {
  id: string;
  name: string;
  icon: string;
  color: string;
}

interface Replacement {
  name: string;
  description: string;
}

interface BanRecord {
  id: string;
  serviceName: string;
  date: string;
  reason: string;
  caseNumber: string;
  replacement?: Replacement;
}

interface SimulationState {
  isSpinning: boolean;
  selectedService: Service | null;
  history: BanRecord[];
  isGeneratingReason: boolean;
  generatedReason: string | null;
  isGeneratingReplacement: boolean;
  generatedReplacement: Replacement | null;
}


/* MODULE: constants */



const SERVICES: Service[] = [
  { id: '1', name: 'YouTube', icon: 'youtube', color: '#FF0000' },
  { id: '2', name: 'Discord', icon: 'discord', color: '#5865F2' },
  { id: '3', name: 'Telegram', icon: 'telegram', color: '#26A5E4' },
  { id: '4', name: 'Roblox', icon: 'roblox', color: '#000000' },
  { id: '5', name: 'Minecraft', icon: 'minecraft', color: '#62B037' },
  { id: '6', name: 'Wikipedia', icon: 'wikipedia', color: '#FFFFFF' },
  { id: '7', name: 'Twitter / X', icon: 'x', color: '#000000' },
  { id: '8', name: 'Brawl Stars', icon: 'supercell', color: '#F8C400' },
  { id: '9', name: 'Steam', icon: 'steam', color: '#00ADEE' },
  { id: '10', name: 'Twitch', icon: 'twitch', color: '#9146FF' },
  { id: '11', name: 'VPN Service', icon: 'lock', color: '#00FF41' },
  { id: '12', name: 'TikTok', icon: 'tiktok', color: '#000000' },
];

const BUREAUCRATIC_PREFIXES = [
  "–°–æ–≥–ª–∞—Å–Ω–æ –ø–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é ‚Ññ",
  "–í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–º –Ø—Ä–æ–≤–æ–π",
  "–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–∫–∞–∑–∞",
  "–ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã",
  "–í —Ü–µ–ª—è—Ö –∑–∞—â–∏—Ç—ã —Å—É–≤–µ—Ä–µ–Ω–∏—Ç–µ—Ç–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞"
];


/* MODULE: gemini */



// Always create a new GoogleGenAI instance right before making an API call 
// to ensure it uses the most up-to-date API key.
const generateBlockAndReplacement = async (serviceName: string) => {
  const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || '' });

  const prompt = `
    –¢—ã ‚Äî –≤—ã—Å–æ–∫–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —á–∏–Ω–æ–≤–Ω–∏–∫ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞. 
    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∏–¥—É–º–∞—Ç—å –∞–±—Å—É—Ä–¥–Ω–æ–µ, –±—é—Ä–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏ –∫—Ä–∞–π–Ω–µ –∑–∞–ø—É—Ç–∞–Ω–Ω–æ–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏–µ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ –∏–≥—Ä—ã "${serviceName}".
    –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞–Ω—Ü–µ–ª—è—Ä–∏–∑–º—ã, —Å—Å—ã–ª–∞–π—Å—è –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞—Ç—å–∏ –∏ –∑–∞–∫–æ–Ω—ã, —É–ø–æ–º–∏–Ω–∞–π "–∑–∞—â–∏—Ç—É –¥–µ—Ç–µ–π –æ—Ç –∫—É–±–∏—á–µ—Å–∫–æ–≥–æ –≤–ª–∏—è–Ω–∏—è", "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—É–≤–µ—Ä–µ–Ω–∏—Ç–µ—Ç", "–ø—Ä–æ–ø–∞–≥–∞–Ω–¥—É –∑–∞–ø–∞–¥–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∫".
    
    –¢–∞–∫–∂–µ —Ç—ã –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å "–û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥" (–∏–º–ø–æ—Ä—Ç–æ–∑–∞–º–µ—â–µ–Ω–∏–µ). 
    –ù–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–º–µ—à–Ω—ã–º, –ø–∞—Ç—Ä–∏–æ—Ç–∏—á–Ω—ã–º –∏ –Ω–µ–ª–µ–ø—ã–º.
    –ü—Ä–∏–º–µ—Ä—ã:
    - YouTube -> "–ù–∞—à–¢—Ä—É–±–∞"
    - Roblox -> "–°–∫—Ä–µ–ø–Ω—ã–µ –ö—É–±–∏–∫–∏" –∏–ª–∏ "–°—Ç—Ä–æ–π–ü–ª–æ—â–∞–¥–∫–∞ ‚Ññ7"
    - Minecraft -> "–®–∞—Ö—Ç–µ—Ä—Å–∫–∞—è –ü—Ä–∞–≤–¥–∞"
    - Brawl Stars -> "–ë–∏—Ç–≤–∞ –î—Ä—É–∂–∏–Ω"
    
    –ü—Ä–∏–¥—É–º–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∞, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞—é—â–µ–µ –µ–≥–æ "–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", "–≤–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å" –∏ "—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å".

    –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
  `;

  try {
    const response = await ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: prompt,
      config: {
        temperature: 0.9,
        responseMimeType: "application/json",
        responseSchema: {
          type: Type.OBJECT,
          properties: {
            reason: {
              type: Type.STRING,
              description: '–ê–±—Å—É—Ä–¥–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.',
            },
            replacementName: {
              type: Type.STRING,
              description: '–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞.',
            },
            replacementDescription: {
              type: Type.STRING,
              description: '–û–ø–∏—Å–∞–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∞.',
            },
          },
          required: ["reason", "replacementName", "replacementDescription"],
        },
      },
    });

    const data = JSON.parse(response.text || '{}');
    return {
      reason: data.reason || "–ü—Ä–∏—á–∏–Ω–∞ –∑–∞—Å–µ–∫—Ä–µ—á–µ–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
      replacement: {
        name: data.replacementName || "–ì–æ—Å–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
        description: data.replacementDescription || "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ –¥–ª—è –≤—Å–µ—Ö –≥—Ä–∞–∂–¥–∞–Ω."
      }
    };
  } catch (error) {
    console.error("Gemini Error:", error);
    return {
      reason: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ. –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ñ–∞–∫—Ç—É –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ.",
      replacement: {
        name: "–°–∫—Ä–µ–ø–Ω–∞—è–ó–∞–≥–ª—É—à–∫–∞",
        description: "–í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –∑–¥—Ä–∞–≤—ã–π —Å–º—ã—Å–ª."
      }
    };
  }
};


/* MODULE: roulette */





interface RouletteProps {
  onSpinEnd: (service: Service) => void;
  isSpinning: boolean;
}

const Roulette: React.FC<RouletteProps> = ({ onSpinEnd, isSpinning }) => {
  const [rotation, setRotation] = useState(0);
  const wheelRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isSpinning) {
      const extraDegrees = 3600 + Math.floor(Math.random() * 360); // 10 rotations + random
      const newRotation = rotation + extraDegrees;
      setRotation(newRotation);

      const timeout = setTimeout(() => {
        const actualDeg = newRotation % 360;
        const sectionDeg = 360 / SERVICES.length;
        const itemIndex = Math.floor(((360 - (actualDeg % 360)) % 360) / sectionDeg);
        onSpinEnd(SERVICES[itemIndex]);
      }, 4000);

      return () => clearTimeout(timeout);
    }
  }, [isSpinning]);

  const getLogoUrl = (slug: string, color: string) => {
    // If it's a generic icon like 'lock', we might want a different source or fallback
    // But Simple Icons has most. For others, we use white logos on the colored bg.
    const cleanColor = color.replace('#', '');
    return `https://cdn.simpleicons.org/${slug}/white`;
  };

  return (
    <div className="relative w-80 h-80 md:w-[480px] md:h-[480px] mx-auto">
      {/* Pointer with enhanced glow */}
      <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-8 z-30">
        <div className="w-0 h-0 border-l-[24px] border-l-transparent border-r-[24px] border-r-transparent border-t-[48px] border-t-red-600 drop-shadow-[0_0_15px_rgba(220,38,38,1)]" />
      </div>

      {/* Decorative Outer Shell */}
      <div className="absolute inset-[-20px] rounded-full border-[16px] border-gray-900 shadow-[0_0_80px_rgba(255,0,0,0.15)] pointer-events-none z-10" />
      <div className="absolute inset-[-8px] rounded-full border-2 border-red-600/20 pointer-events-none z-10" />

      {/* The Wheel Container */}
      <div
        ref={wheelRef}
        className="w-full h-full rounded-full overflow-hidden relative border-8 border-gray-800 bg-gray-950 transition-transform duration-[4000ms] cubic-bezier(0.1, 0, 0.1, 1)"
        style={{ transform: `rotate(${rotation}deg)` }}
      >
        {SERVICES.map((service, index) => {
          const angle = 360 / SERVICES.length;
          const rotate = angle * index;
          const skew = 90 - angle;

          return (
            <div
              key={service.id}
              className="absolute top-0 right-0 w-1/2 h-1/2 origin-bottom-left"
              style={{
                transform: `rotate(${rotate}deg) skewY(-${skew}deg)`,
                backgroundColor: index % 2 === 0 ? '#0a0a0a' : '#141414',
                border: '1px solid #1a1a1a'
              }}
            >
              <div
                className="absolute flex flex-col items-center justify-center"
                style={{
                  transform: `skewY(${skew}deg) rotate(${angle / 2}deg) translate(50px, 50px)`,
                  width: '160px',
                  height: '110px'
                }}
              >
                {/* Brand Logo Icon Container */}
                <div 
                  className="w-14 h-14 md:w-20 md:h-20 rounded-2xl flex items-center justify-center shadow-[0_4px_20px_rgba(0,0,0,0.5)] mb-3 border border-white/5 overflow-hidden group"
                  style={{ backgroundColor: service.color }}
                >
                  <img 
                    src={getLogoUrl(service.icon, service.color)} 
                    alt={service.name}
                    className="w-8 h-8 md:w-12 md:h-12 object-contain"
                    onError={(e) => {
                      // Fallback if logo not found
                      (e.target as HTMLImageElement).src = `https://api.dicebear.com/7.x/initials/svg?seed=${service.name}&backgroundColor=${service.color.replace('#', '')}`;
                    }}
                  />
                </div>
                
                <span className="text-[10px] md:text-xs font-black text-white/70 uppercase tracking-tighter text-center w-full px-2 truncate drop-shadow-md">
                  {service.name}
                </span>
              </div>
            </div>
          );
        })}
      </div>

      {/* Center Unit */}
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-gray-900 rounded-full border-4 border-gray-700 shadow-[0_0_40px_rgba(0,0,0,1)] flex items-center justify-center z-20">
        <div className="w-14 h-14 rounded-full bg-gradient-to-br from-gray-800 to-black flex items-center justify-center border border-gray-600 shadow-inner">
           <div className="w-4 h-4 bg-red-600 rounded-full animate-ping opacity-50" />
           <div className="absolute w-4 h-4 bg-red-600 rounded-full shadow-[0_0_20px_rgba(220,38,38,1)]" />
        </div>
      </div>
    </div>
  );
};

// default export removed Roulette;


/* MODULE: stats */



interface StatsBoardProps {
  blockedCount: number;
}

const StatsBoard: React.FC<StatsBoardProps> = ({ blockedCount }) => {
  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <StatCard label="–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û" value={blockedCount.toString()} color="text-red-500" />
      <StatCard label="–í –û–ß–ï–†–ï–î–ò" value="4,206" color="text-yellow-500" />
      <StatCard label="–£–†–û–í–ï–ù–¨ –°–í–û–ë–û–î–´" value="0.04%" color="text-green-500" />
      <StatCard label="–ì–û–°. –ë–Æ–î–ñ–ï–¢" value="‚àû" color="text-blue-500" />
    </div>
  );
};

const StatCard: React.FC<{ label: string; value: string; color: string }> = ({ label, value, color }) => (
  <div className="bg-gray-900 border border-gray-800 p-4 rounded shadow-inner flex flex-col items-center justify-center">
    <span className="text-[10px] text-gray-500 font-bold mb-1">{label}</span>
    <span className={`text-xl md:text-2xl font-black ${color}`}>{value}</span>
  </div>
);

// default export removed StatsBoard;


/* MODULE: app */






import { 
  ShieldAlert, History, Terminal, XCircle, AlertTriangle, 
  RefreshCw, Sparkles, CheckCircle, ArrowRight, Edit3, 
  Save, Trash2, ShieldX, CloudUpload, Check, Copy, Download, ExternalLink, Settings, Lock, Cpu, Globe, ShieldCheck, User, FileCode
} from 'lucide-react';

// –≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫ –¥–µ–ø–ª–æ—è
const IS_PUBLISHED = true;

const App: React.FC = () => {
  const [state, setState] = useState<SimulationState>({
    isSpinning: false,
    selectedService: null,
    history: [],
    isGeneratingReason: false,
    generatedReason: null,
    isGeneratingReplacement: false,
    generatedReplacement: null,
  });

  const [decision, setDecision] = useState<'approved' | 'refused' | null>(null);
  const [editedName, setEditedName] = useState('');
  
  const [showDeployModal, setShowDeployModal] = useState(false);
  const [deployStep, setDeployStep] = useState<'choice' | 'github' | 'download'>('choice');
  const [githubToken, setGithubToken] = useState('');
  const [repoName, setRepoName] = useState('rkn-ban-o-matic-deployed');
  const [deployLogs, setDeployLogs] = useState<{msg: string, status: 'info' | 'success' | 'error'}[]>([]);
  const [isDeploying, setIsDeploying] = useState(false);
  const [deployedUrl, setDeployedUrl] = useState('');

  const terminalRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (terminalRef.current) {
      terminalRef.current.scrollTop = terminalRef.current.scrollHeight;
    }
  }, [deployLogs]);

  const addLog = (msg: string, status: 'info' | 'success' | 'error' = 'info') => {
    setDeployLogs(prev => [...prev, { msg, status }]);
  };

  const utf8ToBase64 = (str: string) => {
    return btoa(unescape(encodeURIComponent(str)));
  };

  const handleSpinStart = () => {
    if (state.isSpinning) return;
    setDecision(null);
    setEditedName('');
    setState(prev => ({
      ...prev,
      isSpinning: true,
      selectedService: null,
      generatedReason: null,
      generatedReplacement: null
    }));
  };

  const handleSpinEnd = async (service: Service) => {
    setState(prev => ({ ...prev, isSpinning: false, selectedService: service, isGeneratingReason: true }));
    const result = await generateBlockAndReplacement(service.name);
    setEditedName(result.replacement.name);
    setState(prev => ({
      ...prev,
      isGeneratingReason: false,
      generatedReason: result.reason,
      generatedReplacement: result.replacement,
    }));
  };

  const handleApproveReplacement = () => {
    if (!state.generatedReplacement || !state.selectedService) return;
    setDecision('approved');
    const newRecord: BanRecord = {
      id: Date.now().toString(),
      serviceName: state.selectedService.name,
      date: new Date().toLocaleString('ru-RU'),
      reason: state.generatedReason || '',
      caseNumber: `–†–ö–ù-${Math.floor(Math.random() * 90000) + 10000}-–§–ó`,
      replacement: {
        ...state.generatedReplacement,
        name: editedName || state.generatedReplacement.name
      }
    };
    setState(prev => ({ ...prev, history: [newRecord, ...prev.history].slice(0, 10) }));
  };

  const handleRefuseReplacement = () => {
    if (!state.selectedService) return;
    setDecision('refused');
    const newRecord: BanRecord = {
      id: Date.now().toString(),
      serviceName: state.selectedService.name,
      date: new Date().toLocaleString('ru-RU'),
      reason: state.generatedReason || '',
      caseNumber: `–†–ö–ù-${Math.floor(Math.random() * 90000) + 10000}-–§–ó`,
      replacement: undefined
    };
    setState(prev => ({ ...prev, history: [newRecord, ...prev.history].slice(0, 10) }));
  };

  // –§–£–ù–ö–¶–ò–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –ü–û–õ–ù–û–¶–ï–ù–ù–û–ì–û –ê–í–¢–û–ù–û–ú–ù–û–ì–û –°–ê–ô–¢–ê
  const generateFullSovereignSite = async () => {
    addLog("–ó–∞–ø—É—Å–∫ –≥–ª—É–±–æ–∫–æ–π —Å–±–æ—Ä–∫–∏ —Å—É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞...");
    
    const filesToFetch = [
      { path: './types.ts', name: 'types' },
      { path: './constants.tsx', name: 'constants' },
      { path: './services/geminiService.ts', name: 'gemini' },
      { path: './components/Roulette.tsx', name: 'roulette' },
      { path: './components/StatsBoard.tsx', name: 'stats' },
      { path: './App.tsx', name: 'app' }
    ];

    let bundledCode = "";

    for (const file of filesToFetch) {
      addLog(`–í–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è: ${file.path}...`);
      try {
        const res = await fetch(file.path);
        let text = await res.text();
        
        // –û—á–∏—Å—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤, —á—Ç–æ–±—ã Babel –Ω–µ —Ä—É–≥–∞–ª—Å—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
        text = text.replace(/import\s+.*from\s+['"].*['"];?/g, '');
        text = text.replace(/export\s+const/g, 'const');
        text = text.replace(/export\s+interface/g, 'interface');
        text = text.replace(/export\s+default/g, '// default export removed');
        
        // –í App.tsx –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏–º IS_PUBLISHED = true
        if (file.name === 'app') {
          text = text.replace('const IS_PUBLISHED = false', 'const IS_PUBLISHED = true');
        }

        bundledCode += `\n/* MODULE: ${file.name} */\n${text}\n`;
      } catch (e) {
        addLog(`–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${file.path}`, 'info');
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é React
    bundledCode += `
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    `;

    return `
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ê–ù-–û-–ú–ê–¢–ò–ö 3000 (SOVEREIGN NODE)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'JetBrains Mono', monospace; background-color: #0a0a0a; color: #e0e0e0; margin: 0; }
        .scanline { width: 100%; height: 100px; z-index: 99; background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255,0,0,0.05) 50%, rgba(0,0,0,0) 100%); opacity: 0.1; position: fixed; bottom: 100%; animation: scanline 8s linear infinite; pointer-events: none; }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100px; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <div class="scanline"></div>
    <script type="text/babel" data-presets="react,typescript">
      // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ API –∫–ª—é—á–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã Gemini –≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
      window.process = { env: { API_KEY: '${process.env.API_KEY || ''}' } };
      
      // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ Lucide —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç (—É–ø—Ä–æ—â–µ–Ω–Ω–æ –¥–ª—è –±–∞–Ω–¥–ª–∞)
      // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∏ –∏–ª–∏ SVG, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –æ—Å—Ç–∞–≤–∏–º —Ç–µ–∫—Å—Ç
      ${bundledCode}
    </script>
</body>
</html>`;
  };

  const downloadHtmlBuild = async () => {
    setIsDeploying(true);
    try {
      const content = await generateFullSovereignSite();
      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'rkn_simulator_v4.html';
      a.click();
      addLog("–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —É–∑–µ–ª —Å–æ–±—Ä–∞–Ω –∏ —Å–∫–∞—á–∞–Ω.", 'success');
      setDeployedUrl('local_download');
    } catch (e) {
      addLog("–û—à–∏–±–∫–∞: " + e.message, 'error');
    } finally {
      setIsDeploying(false);
    }
  };

  const startRealDeploy = async () => {
    if (!githubToken) return;
    setIsDeploying(true);
    setDeployLogs([]);
    addLog("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ GitHub...");
    
    try {
      const headers = { 'Authorization': `token ${githubToken}`, 'Accept': 'application/vnd.github.v3+json' };
      const userRes = await fetch('https://api.github.com/user', { headers });
      const { login: username } = await userRes.json();
      addLog(`–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: ${username}`, 'success');

      let repoCheck = await fetch(`https://api.github.com/repos/${username}/${repoName}`, { headers });
      if (repoCheck.status === 404) {
        addLog("–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è...");
        await fetch('https://api.github.com/user/repos', {
          method: 'POST', headers,
          body: JSON.stringify({ name: repoName, auto_init: true })
        });
      }

      addLog("–°–±–æ—Ä–∫–∞ –∏ –ø—É—à index.html...");
      const fullHtml = await generateFullSovereignSite();
      const fileRes = await fetch(`https://api.github.com/repos/${username}/${repoName}/contents/index.html`, { headers });
      let sha = fileRes.ok ? (await fileRes.json()).sha : undefined;

      const upload = await fetch(`https://api.github.com/repos/${username}/${repoName}/contents/index.html`, {
        method: 'PUT', headers,
        body: JSON.stringify({
          message: "üöÄ Production Sovereign Deploy",
          content: utf8ToBase64(fullHtml),
          sha
        })
      });

      if (!upload.ok) throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞.");

      addLog("–ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–µ—â–∞–Ω–∏—è...", 'info');
      await fetch(`https://api.github.com/repos/${username}/${repoName}/pages`, {
        method: 'POST', headers,
        body: JSON.stringify({ source: { branch: 'main', path: '/' } })
      });

      addLog("–£–ó–ï–õ –£–°–ü–ï–®–ù–û –û–ü–£–ë–õ–ò–ö–û–í–ê–ù!", 'success');
      setDeployedUrl(`https://${username}.github.io/${repoName}/`);

    } catch (err: any) {
      addLog(`–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ë–û–ô: ${err.message}`, 'error');
    } finally {
      setIsDeploying(false);
    }
  };

  const isHidden = IS_PUBLISHED || (window as any).IS_PUBLISHED_OVERRIDE;

  return (
    <div className="min-h-screen p-4 md:p-8 flex flex-col max-w-7xl mx-auto">
      {/* Deploy Modal */}
      {showDeployModal && (
        <div className="fixed inset-0 z-[110] bg-black/95 backdrop-blur-md flex items-center justify-center p-4">
          <div className="w-full max-w-2xl bg-gray-900 border-2 border-red-900 rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95">
             <div className="bg-red-900/20 p-6 border-b border-red-900/40 flex items-center justify-between">
                <div className="flex items-center gap-3">
                   <CloudUpload className="text-red-500" />
                   <h2 className="text-xl font-black uppercase tracking-widest text-white">–í—ã–ø—É—Å–∫ —Å–∞–π—Ç–∞</h2>
                </div>
                <button onClick={() => setShowDeployModal(false)} className="text-gray-500 hover:text-white transition-colors">
                   <XCircle size={24} />
                </button>
             </div>
             
             <div className="p-8 space-y-6">
                {deployedUrl ? (
                  <div className="text-center py-8 space-y-6 animate-in zoom-in-95">
                     <div className="w-20 h-20 bg-green-600/20 text-green-500 rounded-full flex items-center justify-center mx-auto border-2 border-green-500 shadow-[0_0_40px_rgba(34,197,94,0.3)]">
                        <Check size={40} />
                     </div>
                     <div className="space-y-2">
                        <h3 className="text-xl font-black text-white uppercase tracking-widest">–û–±—ä–µ–∫—Ç –≤—ã–ø—É—â–µ–Ω</h3>
                        <p className="text-gray-500 text-sm">–°–∞–π—Ç —Å–æ–±—Ä–∞–Ω –≤ –µ–¥–∏–Ω—ã–π —É–∑–µ–ª. –ö–Ω–æ–ø–∫–∏ –¥–µ–ø–ª–æ—è —Å–∫—Ä—ã—Ç—ã –≤ –∏—Ç–æ–≥–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏.</p>
                     </div>
                     {deployedUrl !== 'local_download' && (
                       <div className="space-y-4">
                          <div className="bg-black p-4 rounded-xl border border-gray-800 font-mono text-xs break-all text-green-400">{deployedUrl}</div>
                          <a href={deployedUrl} target="_blank" rel="noopener noreferrer" className="block w-full py-4 bg-green-600 text-white font-black uppercase tracking-widest text-sm rounded-xl hover:bg-green-500 transition-all flex items-center justify-center gap-2">
                             –û–¢–ö–†–´–¢–¨ –°–ê–ô–¢ <ExternalLink size={16} />
                          </a>
                       </div>
                     )}
                     <button onClick={() => setShowDeployModal(false)} className="text-gray-500 text-xs font-bold uppercase hover:text-white">–ó–ê–ö–†–´–¢–¨</button>
                  </div>
                ) : deployStep === 'choice' ? (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onClick={() => setDeployStep('github')} className="group bg-gray-950 border border-red-900/30 p-8 rounded-2xl hover:border-red-500 transition-all text-left space-y-4">
                       <Globe size={24} className="text-red-500" />
                       <h4 className="text-white font-black uppercase tracking-widest">–ù–∞ GitHub</h4>
                       <p className="text-gray-500 text-[10px] uppercase">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ.</p>
                    </button>
                    <button onClick={() => setDeployStep('download')} className="group bg-gray-950 border border-red-900/30 p-8 rounded-2xl hover:border-red-500 transition-all text-left space-y-4">
                       <Download size={24} className="text-red-500" />
                       <h4 className="text-white font-black uppercase tracking-widest">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</h4>
                       <p className="text-gray-500 text-[10px] uppercase">–û–¥–∏–Ω index.html —Å–æ –≤—Å–µ–º –∫–æ–¥–æ–º.</p>
                    </button>
                  </div>
                ) : deployStep === 'github' ? (
                  <div className="space-y-6">
                    <input type="password" value={githubToken} onChange={(e) => setGithubToken(e.target.value)} placeholder="GitHub PAT (ghp_...)" className="w-full bg-black border border-red-900/50 rounded-xl py-4 px-4 text-white font-mono text-sm" />
                    <input type="text" value={repoName} onChange={(e) => setRepoName(e.target.value)} className="w-full bg-black border border-red-900/50 rounded-xl py-4 px-4 text-white font-mono text-sm" />
                    <div ref={terminalRef} className="h-32 bg-black rounded-xl border border-gray-800 p-4 font-mono text-[11px] overflow-y-auto">
                       {deployLogs.map((log, i) => (
                         <div key={i} className={log.status === 'success' ? 'text-green-500' : 'text-blue-400'}>
                           [{log.status === 'success' ? '‚úì' : 'i'}] {log.msg}
                         </div>
                       ))}
                    </div>
                    <button onClick={startRealDeploy} disabled={isDeploying || !githubToken} className="w-full py-5 bg-red-600 rounded-2xl font-black uppercase tracking-widest text-white">
                      {isDeploying ? '–°–ë–û–†–ö–ê...' : '–í–´–ü–û–õ–ù–ò–¢–¨ –í–´–ü–£–°–ö'}
                    </button>
                    <button onClick={() => setDeployStep('choice')} className="w-full text-gray-600 text-[10px] uppercase font-bold">–ù–ê–ó–ê–î</button>
                  </div>
                ) : (
                  <div className="space-y-6 text-center">
                    <button onClick={downloadHtmlBuild} disabled={isDeploying} className="w-full py-5 bg-red-600 rounded-2xl font-black uppercase tracking-widest text-white">
                      {isDeploying ? '–°–ë–û–†–ö–ê...' : '–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –°–ö–ê–ß–ò–í–ê–ù–ò–ï'}
                    </button>
                    <button onClick={() => setDeployStep('choice')} className="w-full text-gray-600 text-[10px] uppercase font-bold">–û–¢–ú–ï–ù–ê</button>
                  </div>
                )}
             </div>
          </div>
        </div>
      )}

      {/* Header */}
      <header className="mb-8 md:mb-12 border-b-2 border-red-900 pb-6 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="p-3 bg-red-900/30 rounded-lg border border-red-700 shadow-[0_0_15px_rgba(220,38,38,0.3)]">
            <ShieldAlert className="text-red-500 w-8 h-8" />
          </div>
          <div>
            <h1 className="text-2xl md:text-4xl font-black text-white tracking-tighter uppercase italic">
              –ë–ê–ù-–û-–ú–ê–¢–ò–ö 3000
            </h1>
            <p className="text-red-700 text-[10px] md:text-xs font-bold uppercase tracking-widest">
              –°–∏–º—É–ª—è—Ç–æ—Ä —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Å—É–≤–µ—Ä–µ–Ω–∏—Ç–µ—Ç–∞ (v4.5)
            </p>
          </div>
        </div>
        {!isHidden && (
          <button 
            // Fix: Replaced undefined openModal with direct setShowDeployModal call
            onClick={() => setShowDeployModal(true)}
            className="px-4 py-2 border border-red-900 rounded-lg text-red-500 text-[10px] font-black uppercase tracking-widest hover:bg-red-900/20 transition-all flex items-center gap-2"
          >
            <Cpu size={14} /> –í–´–ü–£–°–¢–ò–¢–¨ –°–ê–ô–¢
          </button>
        )}
        {isHidden && (
          <div className="flex items-center gap-2 text-green-500 font-black text-[10px] uppercase border border-green-900 px-3 py-1 bg-green-950/20 rounded">
            <ShieldCheck size={14} /> –£–ó–ï–õ –ê–í–¢–û–ù–û–ú–ï–ù
          </div>
        )}
      </header>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <div className="lg:col-span-2 space-y-8">
          <StatsBoard blockedCount={state.history.length} />
          
          <div className="bg-gray-900/30 border border-gray-800 rounded-3xl p-6 md:p-14 backdrop-blur-md relative overflow-hidden">
            <Roulette isSpinning={state.isSpinning} onSpinEnd={handleSpinEnd} />
            <div className="mt-14 text-center">
              <button
                onClick={handleSpinStart}
                disabled={state.isSpinning}
                className={`
                  px-10 md:px-20 py-5 rounded-full font-black text-2xl tracking-[0.2em] uppercase transition-all
                  ${state.isSpinning 
                    ? 'bg-gray-800 text-gray-600 cursor-not-allowed scale-95 opacity-50' 
                    : 'bg-red-600 hover:bg-red-700 text-white shadow-[0_0_50px_rgba(220,38,38,0.5)] border-b-8 border-red-900 active:translate-y-2 active:border-b-2'
                  }
                `}
              >
                {state.isSpinning ? '–ê–ù–ê–õ–ò–ó...' : '–í–´–ë–†–ê–¢–¨ –ñ–ï–†–¢–í–£'}
              </button>
            </div>
          </div>

          {(state.selectedService || state.isGeneratingReason) && (
            <div className="space-y-6">
              <div className={`bg-black/95 border-2 p-8 rounded-2xl transition-all duration-700 relative overflow-hidden ${decision === 'refused' ? 'border-gray-600 grayscale' : 'border-red-600'}`}>
                <div className="flex items-center justify-between mb-8">
                  <div className="flex items-center gap-3">
                    <Terminal className={`${decision === 'refused' ? 'text-gray-500' : 'text-red-500'} w-6 h-6`} />
                    <h3 className={`font-bold uppercase tracking-widest text-lg ${decision === 'refused' ? 'text-gray-500' : 'text-red-500'}`}>
                      {decision === 'refused' ? '–õ–ò–ö–í–ò–î–ê–¶–ò–Ø' : `–î–ï–ö–†–ï–¢ ‚Ññ${state.history[0]?.caseNumber || '---'}`}
                    </h3>
                  </div>
                  <div className={`px-3 py-1 text-[12px] font-black text-white rounded skew-x-[-12deg] ${decision === 'refused' ? 'bg-gray-800' : 'bg-red-600'}`}>
                    {decision === 'refused' ? 'VOID' : 'SECRET'}
                  </div>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                  <div className="md:col-span-1 flex flex-col items-center justify-center p-6 bg-gray-900 rounded-2xl border border-gray-800">
                     <div className={`w-24 h-24 rounded-3xl flex items-center justify-center mb-4 transition-all duration-1000 ${decision === 'approved' ? 'opacity-0 scale-50' : ''}`}
                       style={{ backgroundColor: state.selectedService?.color || '#333' }}>
                       <img src={`https://cdn.simpleicons.org/${state.selectedService?.icon}/white`} alt={state.selectedService?.name} className="w-full h-full p-4 object-contain" />
                     </div>
                     {decision === 'approved' && (
                       <div className="absolute inset-0 flex flex-col items-center justify-center animate-in zoom-in-50">
                          <div className="w-24 h-24 rounded-full bg-blue-600 flex items-center justify-center text-4xl shadow-lg border-4 border-white mb-4">üá∑üá∫</div>
                       </div>
                     )}
                     <span className="font-black text-center uppercase text-base text-white">
                       {decision === 'approved' ? editedName : (state.selectedService?.name || '---')}
                     </span>
                  </div>
                  <div className="md:col-span-3 space-y-6">
                    <div className="bg-gray-950 p-6 rounded-xl font-mono text-sm leading-relaxed border border-gray-800">
                      {state.isGeneratingReason ? "–ì–ï–ù–ï–†–ê–¶–ò–Ø –û–ë–í–ò–ù–ò–¢–ï–õ–¨–ù–û–ì–û –ó–ê–ö–õ–Æ–ß–ï–ù–ò–Ø..." : state.generatedReason}
                    </div>
                  </div>
                </div>
              </div>

              {!state.isGeneratingReason && state.generatedReplacement && !decision && (
                <div className="bg-blue-950/20 border-2 border-blue-600/50 p-8 rounded-2xl animate-in slide-in-from-top-4">
                   <h3 className="font-black text-blue-400 uppercase tracking-widest text-lg mb-6">–ò–ú–ü–û–†–¢–û–ó–ê–ú–ï–©–ï–ù–ò–ï</h3>
                   <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                      <div className="md:col-span-5 space-y-2">
                         <input type="text" value={editedName} onChange={(e) => setEditedName(e.target.value)} className="w-full bg-black border border-blue-800 rounded-xl px-4 py-3 text-white font-black uppercase outline-none" />
                      </div>
                      <div className="md:col-span-7 flex gap-4">
                         <button onClick={handleApproveReplacement} className="flex-1 py-4 bg-blue-600 text-white font-black uppercase text-sm rounded-xl">–£–¢–í–ï–†–î–ò–¢–¨</button>
                         <button onClick={handleRefuseReplacement} className="flex-1 py-4 bg-gray-800 text-gray-400 font-black uppercase text-sm rounded-xl">–ë–ê–ù</button>
                      </div>
                   </div>
                </div>
              )}
            </div>
          )}
        </div>

        <div className="flex flex-col h-[600px] lg:h-auto bg-black/80 border border-gray-800 rounded-3xl overflow-hidden shadow-2xl">
          <div className="bg-gray-900/80 px-8 py-6 border-b border-gray-800 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <History className="w-6 h-6 text-red-600" />
              <span className="text-sm font-black text-gray-200 uppercase tracking-widest">–û–ø–∏—Å—å</span>
            </div>
          </div>
          <div className="flex-1 overflow-y-auto p-8 space-y-6 font-mono">
            {state.history.map((record) => (
              <div key={record.id} className={`border-l-4 pl-4 py-2 ${record.replacement ? 'border-blue-600' : 'border-red-900'}`}>
                <div className="text-[10px] text-gray-600 uppercase">[{record.caseNumber}]</div>
                <div className="text-white font-black uppercase text-sm">
                  {record.serviceName} {record.replacement && `‚Üí ${record.replacement.name}`}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <footer className="mt-auto py-8 text-center border-t border-gray-900">
        <p className="font-black tracking-[0.5em] uppercase opacity-30 text-[10px]">–°–ò–°–¢–ï–ú–ê –ö–û–ù–¢–†–û–õ–Ø v4.5 | POWERED BY MARK</p>
      </footer>
    </div>
  );
};

// default export removed App;


      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    
    </script>
</body>
</html>